
{
  "entities": {
    "UserProfile": {
      "title": "User Profile",
      "type": "object",
      "description": "Represents a user profile in the Predictatron application.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the user profile." },
        "name": { "type": "string", "description": "The name of the user." },
        "avatar": { "type": "string", "description": "URL or ID for the user's avatar." },
        "score": { "type": "number", "description": "The user's current score." },
        "rank": { "type": "number", "description": "The user's current rank." },
        "previousRank": { "type": "number", "description": "The user's rank from the previous week." },
        "previousScore": { "type": "number", "description": "The user's score from the previous week." },
        "maxRank": { "type": "number", "description": "The user's highest rank this season." },
        "minRank": { "type": "number", "description": "The user's lowest rank this season." },
        "maxScore": { "type": "number", "description": "The user's highest score this season." },
        "minScore": { "type": "number", "description": "The user's lowest score this season." },
        "rankChange": { "type": "number", "description": "The change in rank from the previous week." },
        "scoreChange": { "type": "number", "description": "The change in score from the previous week." },
        "isPro": { "type": "boolean", "description": "Whether the user is a pro player." },
        "email": { "type": "string", "description": "The email address of the user.", "format": "email" },
        "joinDate": { "type": "string", "description": "The date and time the user joined.", "format": "date-time" }
      },
      "required": ["id", "name", "email"]
    },
    "Event": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Event",
      "type": "object",
      "description": "Represents an event or game for which users can make predictions.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the event."
        },
        "name": {
          "type": "string",
          "description": "The name of the event."
        },
        "description": {
          "type": "string",
          "description": "A description of the event."
        },
        "eventDate": {
          "type": "string",
          "description": "The date and time of the event.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "eventDate"
      ]
    },
    "Prediction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Prediction",
      "type": "object",
      "description": "Represents a user's prediction for a specific event.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the prediction."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N Prediction)"
        },
        "eventId": {
          "type": "string",
          "description": "Reference to Event. (Relationship: Event 1:N Prediction)"
        },
        "predictionDetails": {
          "type": "string",
          "description": "The details of the prediction made by the user."
        },
        "score": {
          "type": "number",
          "description": "The score received for the prediction."
        }
      },
      "required": [
        "id",
        "userId",
        "eventId",
        "predictionDetails",
        "score"
      ]
    },
    "LeaderboardEntry": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "LeaderboardEntry",
      "type": "object",
      "description": "Represents a single entry on the leaderboard, linking a user to their score.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the leaderboard entry."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserProfile. (Relationship: UserProfile 1:N LeaderboardEntry)"
        },
        "score": {
          "type": "number",
          "description": "The user's total score for all predictions."
        },
        "rank": {
          "type": "number",
          "description": "The user's current rank on the leaderboard."
        }
      },
      "required": [
        "id",
        "userId",
        "score",
        "rank"
      ]
    },
    "Team": {
      "title": "Team",
      "type": "object",
      "description": "Represents a football team.",
      "properties": {
        "id": { "type": "string" },
        "name": { "type": "string" },
        "logo": { "type": "string" },
        "iconColour": { "type": "string" },
        "bgColourFaint": { "type": "string" },
        "bgColourSolid": { "type": "string" },
        "textColour": { "type": "string" }
      },
      "required": ["id", "name", "logo"]
    },
    "TeamStanding": {
      "title": "TeamStanding",
      "type": "object",
      "description": "Represents a team's standing in the league.",
      "properties": {
        "teamId": { "type": "string" },
        "rank": { "type": "number" },
        "points": { "type": "number" },
        "goalDifference": { "type": "number" },
        "gamesPlayed": { "type": "number" },
        "wins": { "type": "number" },
        "draws": { "type": "number" },
        "losses": { "type": "number" },
        "goalsFor": { "type": "number" },
        "goalsAgainst": { "type": "number" }
      },
      "required": ["teamId", "rank", "points", "gamesPlayed", "wins", "draws", "losses", "goalsFor", "goalsAgainst"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile information. Secured via path-based ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/teams/{teamId}",
        "definition": {
          "entityName": "Team",
          "schema": { "$ref": "#/backend/entities/Team" },
          "description": "Stores team information."
        }
      },
      {
        "path": "/standings/{standingId}",
        "definition": {
          "entityName": "TeamStanding",
          "schema": { "$ref": "#/backend/entities/TeamStanding" },
          "description": "Stores current team standings."
        }
      },
      {
        "path": "/events/{eventId}",
        "definition": {
          "entityName": "Event",
          "schema": {
            "$ref": "#/backend/entities/Event"
          },
          "description": "Stores event details. Top-level collection accessible for reading by all users.",
          "params": [
            {
              "name": "eventId",
              "description": "The unique identifier for the event."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/predictions/{predictionId}",
        "definition": {
          "entityName": "Prediction",
          "schema": {
            "$ref": "#/backend/entities/Prediction"
          },
          "description": "Stores user predictions for events. Secured via path-based ownership under the user's profile.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "predictionId",
              "description": "The unique identifier for the prediction."
            }
          ]
        }
      },
      {
        "path": "/leaderboard/{leaderboardEntryId}",
        "definition": {
          "entityName": "LeaderboardEntry",
          "schema": {
            "$ref": "#/backend/entities/LeaderboardEntry"
          },
          "description": "Stores leaderboard entries. Top-level collection accessible for reading by all users.",
          "params": [
            {
              "name": "leaderboardEntryId",
              "description": "The unique identifier for the leaderboard entry."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support the Predictatron application, focusing on user profiles, events, predictions, and leaderboards. The structure is optimized for security, scalability, and ease of querying.\n\n*   **User Profiles:** User profiles are stored in a `users` collection, enabling easy retrieval and management of user data. The path-based ownership `/users/{userId}` allows straightforward security rules based on `request.auth.uid`.\n*   **Teams and Standings:** Team information and current standings are stored in top-level `teams` and `standings` collections, respectively. This data is public and read by all users.\n*   **Events:** Events are stored in a top-level `events` collection. Since all users can view events, they are stored at the top level. Security rules will ensure only authorized users can create or modify events (e.g., admins).\n*   **Predictions:** Predictions are stored within user-specific subcollections `/users/{userId}/predictions/{predictionId}`. This structure ensures that predictions are directly associated with users. Security rules can easily enforce that only the user can create or modify their predictions.\n*   **Leaderboard:** Leaderboard entries are stored in a top-level `leaderboard` collection. This collection stores aggregate user scores and rankings. Security rules will control who can update the leaderboard (e.g., a server function triggered by prediction updates).\n\n**Authorization Independence:** The structure achieves authorization independence by associating predictions directly with the user's document using a subcollection. No `get()` calls are needed in rules to verify user ownership of predictions.\n\n**QAPs (Rules are not Filters):** The structure supports secure `list` operations (QAPs) as follows:\n*   Listing events, teams, and standings requires no special considerations, as all users can view them.\n*   Listing predictions is secured through path-based ownership (`/users/{userId}/predictions`), allowing rules to efficiently filter by `request.auth.uid`.\n*   The leaderboard collection is public, so any client can list the leaderboard entries."
  }
}

    